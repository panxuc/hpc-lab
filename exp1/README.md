# MPI 异步通信小作业 实验报告 

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | --------- | ---------- |
| 1    | 1        | 1.06      | 5.93       |
| 2    | 2        | 1.02      | 12.04      |
| 3    | 4        | 0.97      | 23.78      |
| 4    | 8        | 0.94      | 48.13      |
| 5    | 16       | 0.93      | 97.79      |
| 6    | 32       | 0.98      | 195.11     |
| 7    | 64       | 1.07      | 335.11     |
| 8    | 128      | 1.12      | 675.15     |
| 9    | 256      | 1.57      | 1134.15    |
| 10   | 512      | 1.68      | 2149.22    |
| 11   | 1024     | 1.90      | 3196.73    |
| 12   | 2048     | 2.33      | 5071.90    |
| 13   | 4096     | 3.16      | 4775.06    |
| 14   | 8192     | 4.51      | 9895.07    |
| 15   | 16384    | 6.35      | 10496.04   |
| 16   | 32768    | 8.30      | 11321.81   |
| 17   | 65536    | 11.50     | 11654.40   |
| 18   | 131072   | 18.15     | 11842.83   |
| 19   | 262144   | 31.33     | 11956.37   |
| 20   | 524288   | 55.75     | 12019.29   |
| 21   | 1048576  | 100.60    | 12044.47   |
| 22   | 2097152  | 185.22    | 12058.49   |
| 23   | 4194304  | 360.29    | 12060.82   |

以太网：


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | --------- | ---------- |
| 1    | 1        | 42.51     | 0.31       |
| 2    | 2        | 42.61     | 0.64       |
| 3    | 4        | 42.56     | 1.28       |
| 4    | 8        | 42.71     | 2.51       |
| 5    | 16       | 42.84     | 5.37       |
| 6    | 32       | 43.15     | 9.59       |
| 7    | 64       | 44.16     | 17.23      |
| 8    | 128      | 45.77     | 35.21      |
| 9    | 256      | 50.26     | 56.18      |
| 10   | 512      | 55.90     | 82.05      |
| 11   | 1024     | 67.40     | 96.36      |
| 12   | 2048     | 84.54     | 105.68     |
| 13   | 4096     | 106.17    | 111.20     |
| 14   | 8192     | 162.33    | 114.32     |
| 15   | 16384    | 210.99    | 116.03     |
| 16   | 32768    | 356.17    | 116.81     |
| 17   | 65536    | 631.51    | 117.20     |
| 18   | 131072   | 1193.22   | 117.40     |
| 19   | 262144   | 2404.14   | 117.51     |
| 20   | 524288   | 4634.67   | 117.58     |
| 21   | 1048576  | 9077.77   | 117.61     |


- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

  - 消息增长时，带宽先快速上升后趋稳，延迟先稳定在一个较低值，后逐渐增加。

- 该趋势在两种网络下有何不同？

  - InfiniBand带宽更高且延迟显著更低，尤其小消息时差异大。以太网延迟更晚开始增加，带宽更早达到饱和。

- 为什么会有这样的趋势？

  - 传输小信息时，延迟主要受网络的固有通信时延约束，传输大信息时，延迟主要受带宽约束。InfiniBand优化低延迟/高吞吐，以太网协议栈更复杂。

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

  - InfiniBand带宽约高100倍，延迟约低30倍。

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     | 796.757         | 837.128           |
| 2    | 100000000 | 20     | 1042.34         | 837.447           |
| 3    | 100000000 | 40     | 1240.06         | 868.411           |
| 4    | 100000000 | 80     | 1650.68         | 867.835           |
| 5    | 100000000 | 160    | 2441.66         | 1600.52           |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

  - 当计算时间大于等于通信时间时，非阻塞通信能完全隐藏通信开销。

- 简述两份代码的不同之处。

  - `mpi_async.cpp` 用的是 `MPI_Isend` 和 `MPI_Wait` 这两个非阻塞通信函数，`mpi_sync.cpp` 用的是 `MPI_Send` 这个阻塞通信函数。

